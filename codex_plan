Codex Plan Note

Strict mode decision:
- We must decide how/when to enable TypeScript strict mode.
- Enabling strict now will create tens/hundreds of errors across the project because legacy modules are not ready.
- Options:
  1) Keep current tsconfig and enforce strict typing only in new modules.
  2) Add a separate tsconfig.strict.json to run strict checks for new code only.
  3) Enable strict globally and schedule a refactor to fix legacy modules.

Work completed in this session:
- Added Grind linking flow with RPC new-wallet checks, DB first-use gate, dual signatures, and partner push after commit.
- Added BlockchainService (Solana web3 + EVM ethers) with timeout handling and EVM history fallback.
- Added Postgres module + repository for grind link storage with transaction lock.
- Added Project Integration service + module.
- Added DTO + controller endpoint: POST /api/wallets/link-grind.
- Upgraded Winston logger utility with info/warn/error helpers.
- Installed new deps via npm install.

New files/modules:
- safedrop-back-main/src/verification/verification.tokens.ts
- safedrop-back-main/src/verification/interfaces/*
- safedrop-back-main/src/verification/repositories/grind-wallet.repository.ts
- safedrop-back-main/src/verification/dto/link-grind.dto.ts
- safedrop-back-main/src/blockchain/blockchain.service.ts
- safedrop-back-main/src/blockchain/blockchain.module.ts
- safedrop-back-main/src/database/postgres.module.ts
- safedrop-back-main/src/database/postgres.tokens.ts
- safedrop-back-main/src/project-integration/project-integration.service.ts
- safedrop-back-main/src/project-integration/project-integration.module.ts

Modified files:
- safedrop-back-main/src/verification/verification.service.ts
- safedrop-back-main/src/verification/verification.controller.ts
- safedrop-back-main/src/verification/verification.module.ts
- safedrop-back-main/src/logger/file-logger.service.ts
- safedrop-back-main/package.json

New dependencies:
- @solana/web3.js, bs58, tweetnacl
- pg, @types/pg

Required env vars:
- DATABASE_URL, PG_POOL_MAX
- SOLANA_RPC_URL, EVM_RPC_URL
- EVM_HISTORY_API_URL, EVM_HISTORY_API_KEY
- RPC_TIMEOUT_MS, RPC_RETRY_MAX, RPC_RETRY_DELAY_MS
- ADDRESS_HASH_SALT
- PROJECT_INTEGRATION_URL, PROJECT_INTEGRATION_API_KEY

Required SQL:
CREATE TABLE grind_wallet_links (
  grind_address TEXT PRIMARY KEY,
  vault_hash TEXT NOT NULL,
  project_id TEXT NOT NULL,
  chain TEXT NOT NULL,
  linked_at TIMESTAMP NOT NULL,
  message_hash TEXT NOT NULL
);

Plan alignment:
- Auth flow updated: email-code sign-up, Google/wallet sign-in for linked accounts.
- 2FA required for link/add/change actions (vault/burner/social/security).
- Canonical endpoints under /api/auth/* and /api/wallets/*, plus /api/partners/analytics.
